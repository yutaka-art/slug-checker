<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub åˆ©ç”¨å¯å¦ãƒã‚§ãƒƒã‚¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #ffffff;
            color: #24292f;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #d0d7de;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #24292f;
            border-bottom: 1px solid #d0d7de;
            padding-bottom: 10px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 0;
        }
        
        .auth-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .sign-in-btn {
            background-color: #0969da;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .sign-in-btn:hover {
            background-color: #0860ca;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid #d0d7de;
        }
        
        .sign-out-btn {
            background: none;
            border: 1px solid #d0d7de;
            color: #656d76;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .sign-out-btn:hover {
            background-color: #f6f8fa;
        }
        
        h2 {
            color: #24292f;
            margin-top: 0;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            font-size: 16px;
            background-color: #ffffff;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #0969da;
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
        }
        
        button {
            padding: 12px 16px;
            background-color: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            white-space: nowrap;
        }
        
        button:hover {
            background-color: #2ea043;
        }
        
        button:disabled {
            background-color: #8c959f;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            min-height: 20px;
        }
        
        .success {
            color: #1a7f37;
            background-color: #dafbe1;
            border: 1px solid #4ac26b;
        }
        
        .error {
            color: #d1242f;
            background-color: #ffebe9;
            border: 1px solid #fd2d20;
        }
        
        .info {
            color: #656d76;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .note {
            background-color: #fff8c5;
            border: 1px solid #d4b82a;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        code {
            background-color: #f6f8fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, monospace;
        }
        
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .warning h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #856404;
        }
        
        .warning ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        
        .warning li {
            margin-bottom: 5px;
        }
        
        .iframe-container {
            margin: 20px 0;
            border: 2px solid #d1d9e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .iframe-header {
            background-color: #f6f8fa;
            padding: 10px;
            border-bottom: 1px solid #d1d9e0;
            font-weight: bold;
            color: #24292f;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 style="margin: 0; border: none; padding: 0;">GitHub åˆ©ç”¨å¯å¦ãƒã‚§ãƒƒã‚¯</h1>
        <div class="auth-section">
            <div id="authDisplay" style="font-size: 14px; color: #656d76;">
                GitHubèªè¨¼çŠ¶æ…‹ã‚’è‡ªå‹•æ¤œå‡ºä¸­...
            </div>
        </div>
    </div>
    
    <div class="warning" id="authWarning">
        <h3>âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …</h3>
        <div id="authWarningContent">
            <p><strong>GitHubèªè¨¼çŠ¶æ…‹ã®è‡ªå‹•æ¤œå‡ºã‚’è©¦è¡Œä¸­...</strong></p>
            <p>Enterprise Slugç¢ºèªã«ã¯GitHubèªè¨¼ãŒå¿…è¦ã§ã™ã€‚ä¸‹è¨˜ãƒœã‚¿ãƒ³ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
            <p>â€» GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒã‚§ãƒƒã‚¯ã¯ã€èªè¨¼çŠ¶æ…‹ã«é–¢ä¿‚ãªãæ­£å¸¸ã«å‹•ä½œã—ã¾ã™ã€‚</p>
            
            <div style="margin-top: 15px;">
                <a href="/api/auth/login" 
                   style="
                       display: inline-block;
                       background-color: #0969da;
                       color: white;
                       text-decoration: none;
                       padding: 10px 20px;
                       border-radius: 6px;
                       font-weight: 500;
                   ">
                   GitHubã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
                </a>
            </div>
        </div>
    </div>
    
    <!-- GitHubèªè¨¼çŠ¶æ…‹æ¤œå‡ºçµæœ -->
    <div id="authStatus"></div>
    
    <div class="container">
        <h2>GitHub ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒã‚§ãƒƒã‚¯</h2>
        <div class="info">
            è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨å¯èƒ½ï¼ˆå…ˆé ­ãƒ»æœ«å°¾ã®ãƒã‚¤ãƒ•ãƒ³ä¸å¯ã€æœ€å¤§39æ–‡å­—ï¼‰
        </div>
        
        <div class="input-group">
            <input type="text" id="usernameInput" placeholder="ä¾‹: acme-dev" maxlength="39">
            <button type="button" id="checkUsernameBtn">ãƒã‚§ãƒƒã‚¯</button>
        </div>
        
        <div id="usernameResult" class="result"></div>
    </div>
    
    <div class="container">
        <h2>Enterprise Slug å­˜åœ¨ç¢ºèª</h2>
        
        <div class="note">
            <strong>ğŸ¯ GitHubå…¬å¼Enterpriseä½œæˆãƒšãƒ¼ã‚¸:</strong> ä¸‹è¨˜ã®ãƒœã‚¿ãƒ³ã§æ–°ã—ã„ã‚¿ãƒ–ã§Enterpriseä½œæˆãƒšãƒ¼ã‚¸ã‚’é–‹ãã€Slugã®æœ‰åŠ¹æ€§ã‚’ç¢ºèªã§ãã¾ã™ã€‚<br>
            <strong>âœ… è¦ä»¶:</strong> GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚<br>
            <strong>ğŸ”§ ä½¿ç”¨æ–¹æ³•:</strong> æ–°ã—ã„ã‚¿ãƒ–ã§å¸Œæœ›ã™ã‚‹Slugã‚’å…¥åŠ›ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æœ‰åŠ¹æ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
        </div>
        
        <div class="note" style="background-color: #f0f8ff; border-color: #b6d7ff; margin-top: 15px;">
            <strong>ğŸ“‹ ç¢ºèªæ‰‹é †:</strong><br>
            1. ä¸‹è¨˜ãƒœã‚¿ãƒ³ã§æ–°ã—ã„ã‚¿ãƒ–ã§Enterpriseä½œæˆãƒšãƒ¼ã‚¸ã‚’é–‹ã<br>
            2. Enterprise nameãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«Slugã‚’å…¥åŠ›<br>
            3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æœ‰åŠ¹æ€§ãŒè¡¨ç¤ºã•ã‚Œã¾ã™<br>
            4. âœ… ç·‘è‰²ã®ãƒã‚§ãƒƒã‚¯ = åˆ©ç”¨å¯èƒ½<br>
            5. âŒ èµ¤è‰²ã®ã‚¨ãƒ©ãƒ¼ = æ—¢ã«ä½¿ç”¨ä¸­ã¾ãŸã¯ç„¡åŠ¹
        </div>
        
        <!-- GitHub Enterpriseä½œæˆãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ -->
        <div class="iframe-container">
            <div class="iframe-header">
                ğŸ”— GitHub Enterprise ä½œæˆãƒšãƒ¼ã‚¸ (å…¬å¼)
            </div>
            <div style="padding: 30px; text-align: center; background-color: #f6f8fa;">
                <div style="margin-bottom: 20px; color: #656d76;">
                    <strong>âš ï¸ GitHubã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã€iframeåŸ‹ã‚è¾¼ã¿ã‚’ç¦æ­¢ã—ã¦ã„ã¾ã™</strong><br>
                    ä¸‹è¨˜ãƒœã‚¿ãƒ³ã§æ–°ã—ã„ã‚¿ãƒ–ã§Enterpriseä½œæˆãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦ãã ã•ã„
                </div>
                
                <button 
                    type="button" 
                    id="openEnterprisePageBtn"
                    style="
                        background-color: #0969da; 
                        color: white; 
                        border: none; 
                        padding: 15px 30px; 
                        border-radius: 8px; 
                        cursor: pointer; 
                        font-size: 16px; 
                        font-weight: bold;
                        margin: 10px;
                    "
                    onmouseover="this.style.backgroundColor='#0860ca'"
                    onmouseout="this.style.backgroundColor='#0969da'"
                >
                    ğŸ”— GitHub Enterpriseä½œæˆãƒšãƒ¼ã‚¸ã‚’é–‹ã
                </button>
                
                <div style="margin-top: 20px; font-size: 14px; color: #656d76;">
                    <strong>ğŸ“‹ æ‰‹é †:</strong><br>
                    1. ä¸Šè¨˜ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ–°ã—ã„ã‚¿ãƒ–ã‚’é–‹ã<br>
                    2. Enterprise nameãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¸Œæœ›ã™ã‚‹Slugã‚’å…¥åŠ›<br>
                    3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æœ‰åŠ¹æ€§ãŒè¡¨ç¤ºã•ã‚Œã¾ã™<br>
                    4. âœ… ç·‘è‰²ã®ãƒã‚§ãƒƒã‚¯ = åˆ©ç”¨å¯èƒ½ / âŒ èµ¤è‰²ã®ã‚¨ãƒ©ãƒ¼ = æ—¢ã«ä½¿ç”¨ä¸­
                </div>
            </div>
        </div>
        
        <div class="note" style="background-color: #fff8c5; border-color: #d4b82a; margin-top: 10px;">
            <strong>âš ï¸ æ³¨æ„:</strong> æ–°ã—ã„ã‚¿ãƒ–ã§GitHubã¸ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒæ±‚ã‚ã‚‰ã‚ŒãŸå ´åˆã¯ã€é€šå¸¸é€šã‚Šã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚<br>
            <strong>ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:</strong> ã™ã¹ã¦ã®æ“ä½œã¯GitHubå…¬å¼ã‚µã‚¤ãƒˆä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€å®‰å…¨ã§ã™ã€‚
        </div>
        
        <!-- å¾“æ¥ã®æ‰‹å‹•ç¢ºèªæ–¹æ³•ã‚‚æ®‹ã™ -->
        <details style="margin-top: 15px;">
            <summary style="cursor: pointer; color: #0969da; font-weight: bold;">ğŸ”§ åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ç¢ºèªã™ã‚‹å ´åˆ</summary>
            <div style="margin-top: 10px; padding: 15px; background-color: #f6f8fa; border: 1px solid #d1d9e0; border-radius: 6px;">
                <div class="input-group">
                    <input type="text" id="slugInput" placeholder="ä¾‹: acme-enterprise">
                    <button type="button" id="openSlugBtn">æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</button>
                </div>
                
                <div class="note" style="background-color: #f6f8fa; border-color: #d1d9e0; margin-top: 10px;">
                    <strong>ğŸ“‹ æ‰‹å‹•ç¢ºèªæ–¹æ³•:</strong><br>
                    â€¢ <strong>404 Not Found</strong> â†’ âœ… <span style="color: #1a7f37;">åˆ©ç”¨å¯èƒ½</span><br>
                    â€¢ <strong>ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹</strong> â†’ âŒ <span style="color: #d1242f;">æ—¢ã«ä½¿ç”¨ä¸­</span><br>
                    â€¢ <strong>ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸ã®èª˜å°</strong> â†’ âŒ <span style="color: #d1242f;">æ—¢ã«ä½¿ç”¨ä¸­</span>
                </div>
            </div>
        </details>
    </div>

    <script>
        // GitHubèªè¨¼çŠ¶æ…‹æ¤œå‡ºã®è©¦è¡Œ
        class GitHubSessionDetector {
            constructor() {
                this.isAuthenticated = false;
                this.user = null;
            }
            
            // Vercel OAuth APIã‚’ä½¿ã£ãŸèªè¨¼çŠ¶æ…‹ã®æ¤œå‡º
            async detectGitHubSession() {
                try {
                    console.log('GitHubèªè¨¼çŠ¶æ…‹ã®æ¤œå‡ºã‚’è©¦è¡Œä¸­...');
                    
                    // Vercel APIçµŒç”±ã§èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
                    const response = await fetch('/api/auth/user', {
                        method: 'GET',
                        credentials: 'include', // ã‚¯ãƒƒã‚­ãƒ¼ã‚’å«ã‚ã‚‹
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const userData = await response.json();
                        console.log('GitHubèªè¨¼æˆåŠŸ:', userData);
                        this.setUser({
                            username: userData.username,
                            avatar: userData.avatar,
                            name: userData.name || userData.username
                        });
                        return true;
                    } else {
                        console.log('GitHub APIèªè¨¼å¤±æ•—:', response.status);
                        return false;
                    }
                } catch (error) {
                    console.log('GitHubèªè¨¼çŠ¶æ…‹æ¤œå‡ºã‚¨ãƒ©ãƒ¼:', error);
                    return false;
                }
            }
            
            // OAuthèªè¨¼ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ¤œå‡º
            checkForGitHubRedirect() {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code'); // OAuthèªè¨¼ã‚³ãƒ¼ãƒ‰
                const state = urlParams.get('state'); // CSRFä¿è­·ç”¨
                const auth = urlParams.get('auth'); // èªè¨¼æˆåŠŸãƒ•ãƒ©ã‚°
                const error = urlParams.get('error'); // ã‚¨ãƒ©ãƒ¼æƒ…å ±
                
                if (error) {
                    console.error('OAuthèªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
                    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                    window.history.replaceState({}, document.title, window.location.pathname);
                    return true; // ã‚¨ãƒ©ãƒ¼ã§ã‚‚å‡¦ç†æ¸ˆã¿ã¨ã—ã¦æ‰±ã†
                }
                
                if (code) {
                    console.log('GitHub OAuthãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’æ¤œå‡º:', { code, state });
                    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                    window.history.replaceState({}, document.title, window.location.pathname);
                    return true;
                }
                
                if (auth === 'success') {
                    console.log('GitHubèªè¨¼æˆåŠŸãƒ•ãƒ©ã‚°ã‚’æ¤œå‡º');
                    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                    window.history.replaceState({}, document.title, window.location.pathname);
                    // èªè¨¼æˆåŠŸæ™‚ã¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å³åº§ã«å–å¾—
                    setTimeout(() => {
                        this.detectGitHubSession();
                    }, 100);
                    return true;
                }
                
                return false;
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¨­å®š
            setUser(userData) {
                this.user = userData;
                this.isAuthenticated = true;
                this.updateUI();
            }
            
            // UIã‚’æ›´æ–°
            updateUI() {
                const authDisplay = document.getElementById('authDisplay');
                const authStatus = document.getElementById('authStatus');
                const authWarning = document.getElementById('authWarning');
                
                if (this.isAuthenticated && this.user) {
                    // èªè¨¼æ¸ˆã¿ã®å ´åˆ
                    if (authDisplay) {
                        authDisplay.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <img src="${this.user.avatar}" alt="${this.user.username}" style="width: 24px; height: 24px; border-radius: 50%;">
                                <span style="color: #24292f; font-weight: 500;">${this.user.username}</span>
                                <a href="/api/auth/logout" style="color: #0969da; text-decoration: none; font-size: 12px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
                            </div>
                        `;
                    }
                    
                    if (authStatus) {
                        authStatus.innerHTML = `
                            <div style="background-color: #d4f8d4; border: 1px solid #4caf50; padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <h3 style="margin: 0 0 10px 0; color: #2e7d32;">âœ… GitHubèªè¨¼æˆåŠŸ</h3>
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <img src="${this.user.avatar}" alt="${this.user.username} Avatar" style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid #4caf50;">
                                    <div>
                                        <strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> ${this.user.username}<br>
                                        ${this.user.name ? `<strong>è¡¨ç¤ºå:</strong> ${this.user.name}<br>` : ''}
                                        <strong>èªè¨¼çŠ¶æ…‹:</strong> ã‚µã‚¤ãƒ³ã‚¤ãƒ³æ¸ˆã¿
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    // è­¦å‘Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
                    if (authWarning) {
                        authWarning.style.display = 'none';
                    }
                } else {
                    // æœªèªè¨¼ã®å ´åˆ
                    if (authDisplay) {
                        authDisplay.innerHTML = `
                            <a href="/api/auth/login" 
                               style="
                                   background-color: #0969da;
                                   color: white;
                                   text-decoration: none;
                                   padding: 8px 16px;
                                   border-radius: 6px;
                                   font-size: 14px;
                                   font-weight: 500;
                               ">
                               GitHubã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
                            </a>
                        `;
                    }
                    
                    if (authStatus) {
                        authStatus.innerHTML = `
                            <div style="background-color: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <h3 style="margin: 0 0 10px 0; color: #856404;">âš ï¸ GitHubèªè¨¼ãŒå¿…è¦ã§ã™</h3>
                                <p style="margin: 0; margin-bottom: 15px;">
                                    Enterprise Slugç¢ºèªæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚
                                </p>
                                <a href="/api/auth/login" 
                                   style="
                                       display: inline-block;
                                       background-color: #0969da;
                                       color: white;
                                       text-decoration: none;
                                       padding: 10px 20px;
                                       border-radius: 6px;
                                       font-weight: 500;
                                   ">
                                   GitHubã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
                                </a>
                            </div>
                        `;
                    }
                    
                    // è­¦å‘Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                    if (authWarning) {
                        authWarning.style.display = 'block';
                    }
                }
            }
            
            // å…¨ã¦ã®æ¤œå‡ºæ–¹æ³•ã‚’è©¦è¡Œ
            async detectAuthentication() {
                console.log('GitHubèªè¨¼çŠ¶æ…‹ã®æ¤œå‡ºã‚’é–‹å§‹...');
                
                // OAuthèªè¨¼ã‚³ãƒ¼ãƒ‰ã®ç¢ºèª
                if (this.checkForGitHubRedirect()) {
                    return;
                }
                
                // Vercel APIçµŒç”±ã§ã®èªè¨¼ãƒã‚§ãƒƒã‚¯
                const apiSuccess = await this.detectGitHubSession();
                if (apiSuccess) {
                    return;
                }
                
                // èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã®UIæ›´æ–°
                this.updateUI();
            }
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªèªè¨¼æ¤œå‡ºã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        const githubDetector = new GitHubSessionDetector();
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('GitHubèªè¨¼çŠ¶æ…‹æ¤œå‡ºãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            
            // èªè¨¼çŠ¶æ…‹ã®æ¤œå‡ºã‚’å®Ÿè¡Œ
            githubDetector.detectAuthentication();
            
            // æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ - è¦ç´ ã‚’å–å¾—
            const usernameInput = document.getElementById('usernameInput');
            const checkUsernameBtn = document.getElementById('checkUsernameBtn');
            const usernameResult = document.getElementById('usernameResult');
            const slugInput = document.getElementById('slugInput');
            const openSlugBtn = document.getElementById('openSlugBtn');
            const openEnterprisePageBtn = document.getElementById('openEnterprisePageBtn');
            
            // è¦ç´ ã®å­˜åœ¨ç¢ºèª
            if (!usernameInput || !checkUsernameBtn || !usernameResult) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒã‚§ãƒƒã‚¯ç”¨ã®è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                document.body.innerHTML = '<h1>ã‚¨ãƒ©ãƒ¼: ãƒšãƒ¼ã‚¸ã®è¦ç´ ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¾ã›ã‚“ã§ã—ãŸ</h1>';
                return;
            }
            
            console.log('ã™ã¹ã¦ã®è¦ç´ ãŒæ­£å¸¸ã«å–å¾—ã•ã‚Œã¾ã—ãŸ');
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®æœ‰åŠ¹æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
            function isValidUsername(username) {
                // å…ˆé ­/æœ«å°¾ãƒã‚¤ãƒ•ãƒ³ä¸å¯ã€è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ã€1-39æ–‡å­—
                const pattern = /^[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,37}[a-zA-Z0-9])?$/;
                return pattern.test(username);
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒã‚§ãƒƒã‚¯ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            checkUsernameBtn.addEventListener('click', async function() {
                console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒã‚§ãƒƒã‚¯ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                
                const username = usernameInput.value.trim();
                usernameResult.innerHTML = '';
                usernameResult.className = 'result';
                
                if (!username) {
                    usernameResult.innerHTML = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                    usernameResult.className = 'result error';
                    return;
                }
                
                if (!isValidUsername(username)) {
                    usernameResult.innerHTML = 'âŒ <strong>å½¢å¼ã‚¨ãƒ©ãƒ¼:</strong> è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨å¯èƒ½ï¼ˆå…ˆé ­ãƒ»æœ«å°¾ã®ãƒã‚¤ãƒ•ãƒ³ä¸å¯ã€æœ€å¤§39æ–‡å­—ï¼‰';
                    usernameResult.className = 'result error';
                    return;
                }
                
                // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                checkUsernameBtn.disabled = true;
                checkUsernameBtn.textContent = 'ãƒã‚§ãƒƒã‚¯ä¸­...';
                usernameResult.innerHTML = 'ğŸ” GitHub APIã§ç¢ºèªä¸­...';
                usernameResult.className = 'result';
                
                try {
                    console.log('GitHub APIã‚’å‘¼ã³å‡ºã—ä¸­:', username);
                    const response = await fetch(`https://api.github.com/users/${encodeURIComponent(username)}`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    console.log('APIå¿œç­”ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', response.status);
                    
                    if (response.status === 200) {
                        usernameResult.innerHTML = 'âŒ <strong>åˆ©ç”¨ã§ãã¾ã›ã‚“</strong> - ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™';
                        usernameResult.className = 'result error';
                    } else if (response.status === 404) {
                        usernameResult.innerHTML = 'âœ… <strong>åˆ©ç”¨å¯èƒ½ã§ã™</strong> - ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“';
                        usernameResult.className = 'result success';
                    } else {
                        usernameResult.innerHTML = `âš ï¸ ä¸æ˜ (HTTP ${response.status}) - æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„`;
                        usernameResult.className = 'result';
                    }
                } catch (error) {
                    console.error('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', error);
                    usernameResult.innerHTML = 'âŒ <strong>é€šä¿¡ã‚¨ãƒ©ãƒ¼:</strong> ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„';
                    usernameResult.className = 'result error';
                } finally {
                    // ãƒœã‚¿ãƒ³ã‚’å†æœ‰åŠ¹åŒ–
                    checkUsernameBtn.disabled = false;
                    checkUsernameBtn.textContent = 'ãƒã‚§ãƒƒã‚¯';
                }
            });
            
            // Enterprise slugãƒšãƒ¼ã‚¸ã‚’é–‹ããƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆæ–°ã—ã„ã‚¿ãƒ–ç”¨ï¼‰
            if (openSlugBtn && slugInput) {
                openSlugBtn.addEventListener('click', function() {
                    console.log('Enterprise slugãƒšãƒ¼ã‚¸ã‚’é–‹ããƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                    
                    const slug = slugInput.value.trim();
                    if (!slug) {
                        alert('Enterprise slugã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                        return;
                    }
                    
                    // åŸºæœ¬çš„ãªå½¢å¼ãƒã‚§ãƒƒã‚¯
                    if (!/^[a-zA-Z0-9-]+$/.test(slug) || slug.length < 1 || slug.length > 100) {
                        alert('Enterprise slugã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“\nï¼ˆè‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ã€1-100æ–‡å­—ï¼‰');
                        return;
                    }
                    
                    const url = `https://github.com/enterprises/${encodeURIComponent(slug)}`;
                    console.log('Enterprise slugãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™:', url);
                    window.open(url, '_blank', 'noopener,noreferrer');
                });
            }
            
            // Enterpriseä½œæˆãƒšãƒ¼ã‚¸ã‚’é–‹ããƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            if (openEnterprisePageBtn) {
                openEnterprisePageBtn.addEventListener('click', function() {
                    console.log('Enterpriseä½œæˆãƒšãƒ¼ã‚¸ã‚’é–‹ããƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                    const url = 'https://github.com/account/enterprises/new?users_type=metered_ghe';
                    console.log('Enterpriseä½œæˆãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™:', url);
                    window.open(url, '_blank', 'noopener,noreferrer');
                });
            }
            
            // Enterã‚­ãƒ¼ã§ã®å®Ÿè¡Œã‚’ã‚µãƒãƒ¼ãƒˆ
            usernameInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    checkUsernameBtn.click();
                }
            });
            
            if (slugInput && openSlugBtn) {
                slugInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        openSlugBtn.click();
                    }
                });
            }
            
            console.log('ã™ã¹ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒè¨­å®šã•ã‚Œã¾ã—ãŸ');
        });
    </script>
</body>
</html>